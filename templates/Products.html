<!DOCTYPE html>
<html>

<head>
	<!-- https://www.w3schools.com/tags/tag_link.asp -->
	<!-- link to add style and icon for the tab -->
	<link rel="icon" href="gmitLogo.png">
	<link rel="stylesheet" href="main.css">
	<!-- title that goes in the browser tab -->
	<title>Shop</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.3/moment.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.js"></script>
    <script>
        window.onload = function() {
  yourFunction(param1, param2);
};
function addProductToTable(product){
            var tableElement = document.getElementById('productTable')
            var rowElement = tableElement.insertRow(-1)
            var orderQuantity = 1;
            rowElement.setAttribute('id',product.ID)
            
            var cell1 = rowElement.insertCell(0);
            cell1.innerHTML = product.id
            var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = product.name
            var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = product.price
            var cell4 = rowElement.insertCell(3);
            cell4.innerHTML = product.qty
            var cell5 = rowElement.insertCell(4);
            cell5.innerHTML = '<div class="inputSpinner"><div class="buyButton" id="'+product.id+'QtyDown"><</div><div>'+orderQuantity+'</div><div id="'+product.id+'QtyUp" class="buyButton" onCLick=('+orderQuantity+'=41)>></div></div>'
            var cell6 = rowElement.insertCell(5);
            cell6.innerHTML = '<div id="'+product.id+'" class="buyButton">Buy</div>'
            $('#'+product.id+ "QtyDown").click(function(){
               console.log(orderQuantity)
               orderQuantity = orderQuantity - 1;
               cell5.innerHTML = '<div class="inputSpinner"><div class="buyButton" id="'+product.id+'QtyDown"><</div><div>'+orderQuantity+'</div><div class="buyButton" onCLick=('+orderQuantity+'=41)>></div></div>'
            });
            $('#'+product.id+ "QtyUp").click(function(){
               console.log(orderQuantity)
               orderQuantity += 1;
               cell5.innerHTML = '<div class="inputSpinner"><div class="buyButton" id="'+product.id+'QtyDown"><</div><div>'+orderQuantity+'</div><div class="buyButton" onCLick=('+orderQuantity+'=41)>></div></div>'
            });
            $('#'+product.id).click(function(){
               doProductQtyUpdate(product.id, orderQuantity)
            });
            
        }
        function updateCustomerInfo(customer){
            var greeting = document.getElementById("greeting");
            greeting.innerHTML = "Welcome " + customer.email + " your cash is â‚¬" + customer.cash
        }
        function processGetCustomerById(result){
                for (customerAttribute of result){
                    customerData = result[0]
                    customer= {}
                    customer.email = customerData.EMAIL
                    customer.pass = customerData.PASSWORD
                    customer.cash = customerData.CASH
                    updateCustomerInfo(customer)
                }
            }
        function processGetAllProductResponse(result){
            for (product of result){
                displayProduct = {}
                displayProduct.id = product.ID
                displayProduct.name = product.NAME
                displayProduct.price = product.PRICE
                displayProduct.qty = product.QTY
                addProductToTable(displayProduct)
            }
        }
        function updateTableHTML() {
            var tableArray = getAllProducts(processGetAllProductResponse)
            var customer = getCustomerById("jennylynch@shophere.com" ,processGetCustomerById)
            var tableBody = document.getElementById("productTable");

      
            
        }
        // I should set this as the default function for the callback how do i do this?
        function doNothing(result){ 
            return "done"
        }
        //***************************************update product quantity**************************************
        function doProductQtyUpdate(id, quantity){ 
            var productTransaction = {"id":id, "qty": quantity}
            updateProductQty(productTransaction, doNothing)
        }
        function updateProductQty(productTransaction, callback){
            $.ajax({   
                "url": "http://127.0.0.1:5000/shop/"+encodeURI(productTransaction.id),
                "method":"PUT",
                "data":JSON.stringify(productTransaction),
                "dataType": "JSON",
                contentType: "application/json; charset=utf-8",
                "success":function(result){
                    //console.log("put request");
                    console.log({updateProductQtyResult: result});
                    getAllProducts(processGetAllProductResponse)
                    callback(result)   
                },
                "error":function(xhr,status,error){
                    console.log("error: "+status+" msg:"+error);
                }
            });
        }
        function getCustomerById(id, callback){
        $.ajax({
            "url": "http://127.0.0.1:5000/customers/"+encodeURI(id),
            "method":"GET",
            "data":"",
            "dataType": "JSON",
            "success":function(result){
                callback(result)
            },
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
            }
        });
    } 
        function getAllProducts(callback){
        $.ajax({
            "url": "http://127.0.0.1:5000/shop",
            "method":"GET",
            "data":"",
            "dataType": "JSON",
            "success":function(result){
                var tableBody = document.getElementById("productTable");
                tableBody.innerHTML=""
                callback(result)
            },
            "error":function(xhr,status,error){
                console.log("error: "+status+" msg:"+error);
            }
        });
    
    }
</script>
</head>
<body onload="updateTableHTML()">
	<div class="topnav">
		<a href="./main.html">Login</a>
		<a class="active" href="./Products.html">Products</a>
	</div>
	<div class="mainContainer">
	
		<h1>Products</h1>
        
		<div id="greeting"></div>
		<div class="pageContainer">
            <div>
                <table class="productTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Stock Quantity</th>
                            <th>Order Quantity</th>
                            <th>Buy</i></th>
                        </tr>
                    </thead>
                    <tbody id="productTable">
                        
                    </tbody>
                </table>
            </div>
			



		</div>
	</div>
</body>

</html>